<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>TinyXml: TinyXML Tutorial</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>
<!-- Generated by Doxygen 1.4.4 -->
<h1><a class="anchor" name="tutorial0">TinyXML Tutorial</a></h1>
<h1>What is this? </h1>
<p>
This tutorial has a few tips and suggestions on how to use TinyXML
effectively.</p>
<p>I've also tried to include some C++ tips like how to convert strings
to integers and vice versa. This isn't anything to do with TinyXML
itself, but it may helpful for your project so I've put it in anyway.</p>
<p>If you don't know basic C++ concepts this tutorial won't be useful.
Likewise if you don't know what a DOM is, look elsewhere first.</p>
<p></p>
<h1>Before we start </h1>
<p>
Some example XML datasets/files will be used.</p>
<p>example1.xml:</p>
<p></p>
<div class="fragment">
<pre class="fragment">&lt;?xml version="1.0" ?&gt;<br>&lt;Hello&gt;World&lt;/Hello&gt;<br></pre>
</div>
<p>example2.xml:</p>
<p></p>
<div class="fragment">
<pre class="fragment">&lt;?xml version="1.0" ?&gt;<br>&lt;poetry&gt;<br>	&lt;verse&gt;<br>		Alas<br>		  Great World<br>			Alas (again)<br>	&lt;/verse&gt;<br>&lt;/poetry&gt;<br></pre>
</div>
<p>example3.xml:</p>
<p></p>
<div class="fragment">
<pre class="fragment">&lt;?xml version="1.0" ?&gt;<br>&lt;shapes&gt;<br>	&lt;circle name="int-based" x="20" y="30" r="50" /&gt;<br>	&lt;point name="float-based" x="3.5" y="52.1" /&gt;<br>&lt;/shapes&gt;<br></pre>
</div>
<p>example4.xml</p>
<p></p>
<div class="fragment">
<pre class="fragment">&lt;?xml version="1.0" ?&gt;<br>&lt;MyApp&gt;<br>    &lt;!-- Settings for MyApp --&gt;<br>    &lt;Messages&gt;<br>        &lt;Welcome&gt;Welcome to MyApp&lt;/Welcome&gt;<br>        &lt;Farewell&gt;Thank you for using MyApp&lt;/Farewell&gt;<br>    &lt;/Messages&gt;<br>    &lt;Windows&gt;<br>        &lt;Window name="MainFrame" x="5" y="15" w="400" h="250" /&gt;<br>    &lt;/Windows&gt;<br>    &lt;Connection ip="192.168.0.1" timeout="123.456000" /&gt;<br>&lt;/MyApp&gt;<br></pre>
</div>
<p></p>
<h1>Getting Started </h1>
<p>
</p>
<h2>Load XML from a file </h2>
<p>
The simplest way to load a file into a TinyXML DOM is:</p>
<p></p>
<div class="fragment">
<pre class="fragment">TiXmlDocument doc( "demo.xml" );<br>doc.LoadFile();<br></pre>
</div>
<p>A more real-world usage is shown below. This will load the file and
display the contents to STDOUT:</p>
<p></p>
<div class="fragment">
<pre class="fragment">// load the named file and dump its structure to STDOUT<br>void dump_to_stdout(const char* pFilename)<br>{<br>	TiXmlDocument doc(pFilename);<br>	bool loadOkay = doc.LoadFile();<br>	if (loadOkay)<br>	{<br>		printf("\n%s:\n", pFilename);<br>		dump_to_stdout( &amp;doc ); // defined later in the tutorial<br>	}<br>	else<br>	{<br>		printf("Failed to load file \"%s\"\n", pFilename);<br>	}<br>}<br></pre>
</div>
<p>A simple demonstration of this function is to use a main like this:</p>
<p></p>
<div class="fragment">
<pre class="fragment">int main(void)<br>{<br>	dump_to_stdout("example1.xml");<br>	return 0;<br>}<br></pre>
</div>
<p>Recall that Example 1 XML is:</p>
<p></p>
<div class="fragment">
<pre class="fragment">&lt;?xml version="1.0" ?&gt;<br>&lt;Hello&gt;World&lt;/Hello&gt;<br></pre>
</div>
<p>Running the program with this XML will display this in the
console/DOS window:</p>
<p></p>
<div class="fragment">
<pre class="fragment">DOCUMENT<br>+ DECLARATION<br>+ ELEMENT Hello<br>  + TEXT[World]<br></pre>
</div>
<p>The ``dump_to_stdout`` function is defined later in this tutorial
and is useful if you want to understand recursive traversal of a DOM.</p>
<p></p>
<h2>Building Documents Programatically </h2>
<p>
This is how to build Example 1 pragmatically:</p>
<p></p>
<div class="fragment">
<pre class="fragment">void build_simple_doc( )<br>{<br>	// Make xml: &lt;?xml ..&gt;&lt;Hello&gt;World&lt;/Hello&gt;<br>	TiXmlDocument doc;<br>	TiXmlDeclaration * decl = new TiXmlDeclaration( "1.0", "", "" );<br>	TiXmlElement * element = new TiXmlElement( "Hello" );<br>	TiXmlText * text = new TiXmlText( "World" );<br>	element-&gt;LinkEndChild( text );<br>	doc.LinkEndChild( decl );<br>	doc.LinkEndChild( element );<br>	doc.SaveFile( "madeByHand.xml" );<br>}<br></pre>
</div>
<p>This can be loaded and displayed on the console with:</p>
<p></p>
<div class="fragment">
<pre class="fragment">dump_to_stdout("madeByHand.xml"); // this func defined later in the tutorial<br></pre>
</div>
<p>and you'll see it is identical to Example 1:</p>
<p></p>
<div class="fragment">
<pre class="fragment">madeByHand.xml:<br>Document<br>+ Declaration<br>+ Element [Hello]<br>  + Text: [World]<br></pre>
</div>
<p>This code produces exactly the same XML DOM but it shows a different
ordering to node creation and linking:</p>
<p></p>
<div class="fragment">
<pre class="fragment">void write_simple_doc2( )<br>{<br>	// same as write_simple_doc1 but add each node<br>	// as early as possible into the tree.<br><br>	TiXmlDocument doc;<br>	TiXmlDeclaration * decl = new TiXmlDeclaration( "1.0", "", "" );<br>	doc.LinkEndChild( decl );<br>	<br>	TiXmlElement * element = new TiXmlElement( "Hello" );<br>	doc.LinkEndChild( element );<br>	<br>	TiXmlText * text = new TiXmlText( "World" );<br>	element-&gt;LinkEndChild( text );<br>	<br>	doc.SaveFile( "madeByHand2.xml" );<br>}<br></pre>
</div>
<p>Both of these produce the same XML, namely:</p>
<p></p>
<div class="fragment">
<pre class="fragment">&lt;?xml version="1.0" ?&gt;<br>&lt;Hello&gt;World&lt;/Hello&gt;<br></pre>
</div>
<p>Or in structure form:</p>
<p></p>
<div class="fragment">
<pre class="fragment">DOCUMENT<br>+ DECLARATION<br>+ ELEMENT Hello<br>  + TEXT[World]<br></pre>
</div>
<p></p>
<h2>Attributes </h2>
<p>
Given an existing node, settings attributes is easy:</p>
<p></p>
<div class="fragment">
<pre class="fragment">window = new TiXmlElement( "Demo" );  <br>window-&gt;SetAttribute("name", "Circle");<br>window-&gt;SetAttribute("x", 5);<br>window-&gt;SetAttribute("y", 15);<br>window-&gt;SetDoubleAttribute("radius", 3.14159);<br></pre>
</div>
<p>You can it also work with the <a class="el"
 href="classTiXmlAttribute.html">TiXmlAttribute</a> objects if you want.</p>
<p>The following code shows one way (not the only way) to get all
attributes of an element, print the name and string value, and if the
value can be converted to an integer or double, print that value too:</p>
<p></p>
<div class="fragment">
<pre class="fragment">// print all attributes of pElement.<br>// returns the number of attributes printed<br>int dump_attribs_to_stdout(TiXmlElement* pElement, unsigned int indent)<br>{<br>	if ( !pElement ) return 0;<br><br>	TiXmlAttribute* pAttrib=pElement-&gt;FirstAttribute();<br>	int i=0;<br>	int ival;<br>	double dval;<br>	const char* pIndent=getIndent(indent);<br>	printf("\n");<br>	while (pAttrib)<br>	{<br>		printf( "%s%s: value=[%s]", pIndent, pAttrib-&gt;Name(), pAttrib-&gt;Value());<br><br>		if (pAttrib-&gt;QueryIntValue(&amp;ival)==TIXML_SUCCESS)    printf( " int=%d", ival);<br>		if (pAttrib-&gt;QueryDoubleValue(&amp;dval)==TIXML_SUCCESS) printf( " d=%1.1f", dval);<br>		printf( "\n" );<br>		i++;<br>		pAttrib=pAttrib-&gt;Next();<br>	}<br>	return i;<br>}<br></pre>
</div>
<p></p>
<h2>Writing a document to a file </h2>
<p>
Writing a pre-built DOM to a file is trivial:</p>
<p></p>
<div class="fragment">
<pre class="fragment">doc.SaveFile( saveFilename );  <br></pre>
</div>
<p>Recall, for example, example 4:</p>
<p></p>
<div class="fragment">
<pre class="fragment">&lt;?xml version="1.0" ?&gt;<br>&lt;MyApp&gt;<br>    &lt;!-- Settings for MyApp --&gt;<br>    &lt;Messages&gt;<br>        &lt;Welcome&gt;Welcome to MyApp&lt;/Welcome&gt;<br>        &lt;Farewell&gt;Thank you for using MyApp&lt;/Farewell&gt;<br>    &lt;/Messages&gt;<br>    &lt;Windows&gt;<br>        &lt;Window name="MainFrame" x="5" y="15" w="400" h="250" /&gt;<br>    &lt;/Windows&gt;<br>    &lt;Connection ip="192.168.0.1" timeout="123.456000" /&gt;<br>&lt;/MyApp&gt;<br></pre>
</div>
<p>The following function builds this DOM and writes the file
"appsettings.xml":</p>
<p></p>
<div class="fragment">
<pre class="fragment">void write_app_settings_doc( )  <br>{  <br>	TiXmlDocument doc;  <br>	TiXmlElement* msg;<br> 	TiXmlDeclaration* decl = new TiXmlDeclaration( "1.0", "", "" );  <br>	doc.LinkEndChild( decl );  <br> <br>	TiXmlElement * root = new TiXmlElement( "MyApp" );  <br>	doc.LinkEndChild( root );  <br><br>	TiXmlComment * comment = new TiXmlComment();<br>	comment-&gt;SetValue(" Settings for MyApp " );  <br>	root-&gt;LinkEndChild( comment );  <br> <br>	TiXmlElement * msgs = new TiXmlElement( "Messages" );  <br>	root-&gt;LinkEndChild( msgs );  <br> <br>	msg = new TiXmlElement( "Welcome" );  <br>	msg-&gt;LinkEndChild( new TiXmlText( "Welcome to MyApp" ));  <br>	msgs-&gt;LinkEndChild( msg );  <br> <br>	msg = new TiXmlElement( "Farewell" );  <br>	msg-&gt;LinkEndChild( new TiXmlText( "Thank you for using MyApp" ));  <br>	msgs-&gt;LinkEndChild( msg );  <br> <br>	TiXmlElement * windows = new TiXmlElement( "Windows" );  <br>	root-&gt;LinkEndChild( windows );  <br><br>	TiXmlElement * window;<br>	window = new TiXmlElement( "Window" );  <br>	windows-&gt;LinkEndChild( window );  <br>	window-&gt;SetAttribute("name", "MainFrame");<br>	window-&gt;SetAttribute("x", 5);<br>	window-&gt;SetAttribute("y", 15);<br>	window-&gt;SetAttribute("w", 400);<br>	window-&gt;SetAttribute("h", 250);<br><br>	TiXmlElement * cxn = new TiXmlElement( "Connection" );  <br>	root-&gt;LinkEndChild( cxn );  <br>	cxn-&gt;SetAttribute("ip", "192.168.0.1");<br>	cxn-&gt;SetDoubleAttribute("timeout", 123.456); // floating point attrib<br>	<br>	dump_to_stdout( &amp;doc );<br>	doc.SaveFile( "appsettings.xml" );  <br>} <br></pre>
</div>
<p>The dump_to_stdout function will show this structure:</p>
<p></p>
<div class="fragment">
<pre class="fragment">Document<br>+ Declaration<br>+ Element [MyApp]<br> (No attributes)<br>  + Comment: [ Settings for MyApp ]<br>  + Element [Messages]<br> (No attributes)<br>    + Element [Welcome]<br> (No attributes)<br>      + Text: [Welcome to MyApp]<br>    + Element [Farewell]<br> (No attributes)<br>      + Text: [Thank you for using MyApp]<br>  + Element [Windows]<br> (No attributes)<br>    + Element [Window]<br>      + name: value=[MainFrame]<br>      + x: value=[5] int=5 d=5.0<br>      + y: value=[15] int=15 d=15.0<br>      + w: value=[400] int=400 d=400.0<br>      + h: value=[250] int=250 d=250.0<br>      5 attributes<br>  + Element [Connection]<br>    + ip: value=[192.168.0.1] int=192 d=192.2<br>    + timeout: value=[123.456000] int=123 d=123.5<br>    2 attributes<br></pre>
</div>
<p>I was surprised that TinyXml, by default, writes the XML in what
other APIs call a "pretty" format - it modifies the whitespace of text
of elements that contain other nodes so that writing the tree includes
an indication of nesting level.</p>
<p>I haven't looked yet to see if there is a way to turn off indenting
when writing a file - its bound to be easy.</p>
<p>[Lee: It's easy in STL mode, just use cout &lt;&lt; myDoc. Non-STL
mode is always in "pretty" format. Adding a switch would be a nice
feature and has been requested.]</p>
<p></p>
<h1>XML to/from C++ objects </h1>
<p>
</p>
<h2>Intro </h2>
<p>
This example assumes you're loading and saving your app settings in an
XML file, e.g. something like example4.xml.</p>
<p>There are a number of ways to do this. For example, look into the
TinyBind project at <a href="http://sourceforge.net/projects/tinybind">http://sourceforge.net/projects/tinybind</a></p>
<p>This section shows a plain-old approach to loading and saving a
basic object structure using XML.</p>
<p></p>
<h2>Set up your object classes </h2>
<p>
Start off with some basic classes like these:</p>
<p></p>
<div class="fragment">
<pre class="fragment">#include &lt;string&gt;<br>#include &lt;map&gt;<br>using namespace std;<br><br>typedef std::map&lt;std::string,std::string&gt; MessageMap;<br><br>// a basic window abstraction - demo purposes only<br>class WindowSettings<br>{<br>public:<br>	int x,y,w,h;<br>	string name;<br><br>	WindowSettings()<br>		: x(0), y(0), w(100), h(100), name("Untitled")<br>	{<br>	}<br><br>	WindowSettings(int x, int y, int w, int h, const string&amp; name)<br>	{<br>		this-&gt;x=x;<br>		this-&gt;y=y;<br>		this-&gt;w=w;<br>		this-&gt;h=h;<br>		this-&gt;name=name;<br>	}<br>};<br><br>class ConnectionSettings<br>{<br>public:<br>	string ip;<br>	double timeout;<br>};<br><br>class AppSettings<br>{<br>public:<br>	string m_name;<br>	MessageMap m_messages;<br>	list&lt;WindowSettings&gt; m_windows;<br>	ConnectionSettings m_connection;<br><br>	AppSettings() {}<br><br>	void save(const char* pFilename);<br>	void load(const char* pFilename);<br>	<br>	// just to show how to do it<br>	void setDemoValues()<br>	{<br>		m_name="MyApp";<br>		m_messages.clear();<br>		m_messages["Welcome"]="Welcome to "+m_name;<br>		m_messages["Farewell"]="Thank you for using "+m_name;<br>		m_windows.clear();<br>		m_windows.push_back(WindowSettings(15,15,400,250,"Main"));<br>		m_connection.ip="Unknown";<br>		m_connection.timeout=123.456;<br>	}<br>};<br></pre>
</div>
<p>This is a basic main() that shows how to create a default settings
object tree, save it and load it again:</p>
<p></p>
<div class="fragment">
<pre class="fragment">int main(void)<br>{<br>	AppSettings settings;<br>	<br>	settings.save("appsettings2.xml");<br>	settings.load("appsettings2.xml");<br>	return 0;<br>}<br></pre>
</div>
<p>The following main() shows creation, modification, saving and then
loading of a settings structure:</p>
<p></p>
<div class="fragment">
<pre class="fragment">int main(void)<br>{<br>	// block: customise and save settings<br>	{<br>		AppSettings settings;<br>		settings.m_name="HitchHikerApp";<br>		settings.m_messages["Welcome"]="Don't Panic";<br>		settings.m_messages["Farewell"]="Thanks for all the fish";<br>		settings.m_windows.push_back(WindowSettings(15,25,300,250,"BookFrame"));<br>		settings.m_connection.ip="192.168.0.77";<br>		settings.m_connection.timeout=42.0;<br><br>		settings.save("appsettings2.xml");<br>	}<br>	<br>	// block: load settings<br>	{<br>		AppSettings settings;<br>		settings.load("appsettings2.xml");<br>		printf("%s: %s\n", settings.m_name.c_str(), <br>			settings.m_messages["Welcome"].c_str());<br>		WindowSettings &amp; w=settings.m_windows.front();<br>		printf("%s: Show window '%s' at %d,%d (%d x %d)\n", <br>			settings.m_name.c_str(), w.name.c_str(), w.x, w.y, w.w, w.h);<br>		printf("%s: %s\n", settings.m_name.c_str(), settings.m_messages["Farewell"].c_str());<br>	}<br>	return 0;<br>}<br></pre>
</div>
<p>When the save() and load() are completed (see below), running this
main() displays on the console:</p>
<p></p>
<div class="fragment">
<pre class="fragment">HitchHikerApp: Don't Panic<br>HitchHikerApp: Show window 'BookFrame' at 15,25 (300 x 100)<br>HitchHikerApp: Thanks for all the fish<br></pre>
</div>
<p></p>
<h2>Encode C++ state as XML </h2>
<p>
There are lots of different ways to approach saving this to a file.
Here's one:</p>
<p></p>
<div class="fragment">
<pre class="fragment">void AppSettings::save(const char* pFilename)<br>{<br>	TiXmlDocument doc;  <br>	TiXmlElement* msg;<br>	TiXmlComment * comment;<br>	string s;<br> 	TiXmlDeclaration* decl = new TiXmlDeclaration( "1.0", "", "" );  <br>	doc.LinkEndChild( decl ); <br> <br>	TiXmlElement * root = new TiXmlElement(m_name.c_str());  <br>	doc.LinkEndChild( root );  <br><br>	comment = new TiXmlComment();<br>	s=" Settings for "+m_name+" ";<br>	comment-&gt;SetValue(s.c_str());  <br>	root-&gt;LinkEndChild( comment );  <br><br>	// block: messages<br>	{<br>		MessageMap::iterator iter;<br><br>		TiXmlElement * msgs = new TiXmlElement( "Messages" );  <br>		root-&gt;LinkEndChild( msgs );  <br> <br>		for (iter=m_messages.begin(); iter != m_messages.end(); iter++)<br>		{<br>			const string &amp; key=(*iter).first;<br>			const string &amp; value=(*iter).second;<br>			msg = new TiXmlElement(key.c_str());  <br>			msg-&gt;LinkEndChild( new TiXmlText(value.c_str()));  <br>			msgs-&gt;LinkEndChild( msg );  <br>		}<br>	}<br><br>	// block: windows<br>	{<br>		TiXmlElement * windowsNode = new TiXmlElement( "Windows" );  <br>		root-&gt;LinkEndChild( windowsNode );  <br><br>		list&lt;WindowSettings&gt;::iterator iter;<br><br>		for (iter=m_windows.begin(); iter != m_windows.end(); iter++)<br>		{<br>			const WindowSettings&amp; w=*iter;<br><br>			TiXmlElement * window;<br>			window = new TiXmlElement( "Window" );  <br>			windowsNode-&gt;LinkEndChild( window );  <br>			window-&gt;SetAttribute("name", w.name.c_str());<br>			window-&gt;SetAttribute("x", w.x);<br>			window-&gt;SetAttribute("y", w.y);<br>			window-&gt;SetAttribute("w", w.w);<br>			window-&gt;SetAttribute("h", w.h);<br>		}<br>	}<br><br>	// block: connection<br>	{<br>		TiXmlElement * cxn = new TiXmlElement( "Connection" );  <br>		root-&gt;LinkEndChild( cxn );  <br>		cxn-&gt;SetAttribute("ip", m_connection.ip.c_str());<br>		cxn-&gt;SetDoubleAttribute("timeout", m_connection.timeout); <br>	}<br><br>	doc.SaveFile(pFilename);  <br>}<br></pre>
</div>
<p>Running this with the modified main produces this file:</p>
<p></p>
<div class="fragment">
<pre class="fragment">&lt;?xml version="1.0" ?&gt;<br>&lt;HitchHikerApp&gt;<br>    &lt;!-- Settings for HitchHikerApp --&gt;<br>    &lt;Messages&gt;<br>        &lt;Farewell&gt;Thanks for all the fish&lt;/Farewell&gt;<br>        &lt;Welcome&gt;Don&amp;apos;t Panic&lt;/Welcome&gt;<br>    &lt;/Messages&gt;<br>    &lt;Windows&gt;<br>        &lt;Window name="BookFrame" x="15" y="25" w="300" h="250" /&gt;<br>    &lt;/Windows&gt;<br>    &lt;Connection ip="192.168.0.77" timeout="42.000000" /&gt;<br>&lt;/HitchHikerApp&gt;<br></pre>
</div>
<p></p>
<h2>Decoding state from XML </h2>
<p>
As with encoding objects, there are a number of approaches to decoding
XML into your own C++ object structure. The following approach uses
TiXmlHandles.</p>
<p></p>
<div class="fragment">
<pre class="fragment">void AppSettings::load(const char* pFilename)<br>{<br>	TiXmlDocument doc(pFilename);<br>	if (!doc.LoadFile()) return;<br><br>	TiXmlHandle hDoc(&amp;doc);<br>	TiXmlElement* pElem;<br>	TiXmlHandle hRoot(0);<br><br>	// block: name<br>	{<br>		pElem=hDoc.FirstChildElement().Element();<br>		// should always have a valid root but handle gracefully if it does<br>		if (!pElem) return;<br>		m_name=pElem-&gt;Value();<br><br>		// save this for later<br>		hRoot=TiXmlHandle(pElem);<br>	}<br><br>	// block: string table<br>	{<br>		m_messages.clear(); // trash existing table<br><br>		pElem=hRoot.FirstChild( "Messages" ).FirstChild().Element();<br>		for( pElem; pElem; pElem=pElem-&gt;NextSiblingElement())<br>		{<br>			const char *pKey=pElem-&gt;Value();<br>			const char *pText=pElem-&gt;GetText();<br>			if (pKey &amp;&amp; pText) <br>			{<br>				m_messages[pKey]=pText;<br>			}<br>		}<br>	}<br><br>	// block: windows<br>	{<br>		m_windows.clear(); // trash existing list<br><br>		TiXmlElement* pWindowNode=hRoot.FirstChild( "Windows" ).FirstChild().Element();<br>		for( pWindowNode; pWindowNode; pWindowNode=pWindowNode-&gt;NextSiblingElement())<br>		{<br>			WindowSettings w;<br>			const char *pName=pWindowNode-&gt;Attribute("name");<br>			if (pName) w.name=pName;<br>			<br>			pWindowNode-&gt;QueryIntAttribute("x", &amp;w.x); // If this fails, original value is left as-is<br>			pWindowNode-&gt;QueryIntAttribute("y", &amp;w.y);<br>			pWindowNode-&gt;QueryIntAttribute("w", &amp;w.w);<br>			pWindowNode-&gt;QueryIntAttribute("hh", &amp;w.h);<br><br>			m_windows.push_back(w);<br>		}<br>	}<br><br>	// block: connection<br>	{<br>		pElem=hRoot.FirstChild("Connection").Element();<br>		if (pElem)<br>		{<br>			m_connection.ip=pElem-&gt;Attribute("ip");<br>			pElem-&gt;QueryDoubleAttribute("timeout",&amp;m_connection.timeout);<br>		}<br>	}<br>}<br></pre>
</div>
<p></p>
<h1>Full listing for dump_to_stdout </h1>
<p>
Below is a copy-and-paste demo program for loading arbitrary XML files
and dumping the structure to STDOUT using the recursive traversal
listed above.</p>
<p></p>
<div class="fragment">
<pre class="fragment">// tutorial demo program<br>#include "stdafx.h"<br>#include "tinyxml.h"<br><br>// ----------------------------------------------------------------------<br>// STDOUT dump and indenting utility functions<br>// ----------------------------------------------------------------------<br>const unsigned int NUM_INDENTS_PER_SPACE=2;<br><br>const char * getIndent( unsigned int numIndents )<br>{<br>	static const char * pINDENT="                                      + ";<br>	static const unsigned int LENGTH=strlen( pINDENT );<br>	unsigned int n=numIndents*NUM_INDENTS_PER_SPACE;<br>	if ( n &gt; LENGTH ) n = LENGTH;<br><br>	return &amp;pINDENT[ LENGTH-n ];<br>}<br><br>// same as getIndent but no "+" at the end<br>const char * getIndentAlt( unsigned int numIndents )<br>{<br>	static const char * pINDENT="                                        ";<br>	static const unsigned int LENGTH=strlen( pINDENT );<br>	unsigned int n=numIndents*NUM_INDENTS_PER_SPACE;<br>	if ( n &gt; LENGTH ) n = LENGTH;<br><br>	return &amp;pINDENT[ LENGTH-n ];<br>}<br><br>int dump_attribs_to_stdout(TiXmlElement* pElement, unsigned int indent)<br>{<br>	if ( !pElement ) return 0;<br><br>	TiXmlAttribute* pAttrib=pElement-&gt;FirstAttribute();<br>	int i=0;<br>	int ival;<br>	double dval;<br>	const char* pIndent=getIndent(indent);<br>	printf("\n");<br>	while (pAttrib)<br>	{<br>		printf( "%s%s: value=[%s]", pIndent, pAttrib-&gt;Name(), pAttrib-&gt;Value());<br><br>		if (pAttrib-&gt;QueryIntValue(&amp;ival)==TIXML_SUCCESS)    printf( " int=%d", ival);<br>		if (pAttrib-&gt;QueryDoubleValue(&amp;dval)==TIXML_SUCCESS) printf( " d=%1.1f", dval);<br>		printf( "\n" );<br>		i++;<br>		pAttrib=pAttrib-&gt;Next();<br>	}<br>	return i;	<br>}<br><br>void dump_to_stdout( TiXmlNode* pParent, unsigned int indent = 0 )<br>{<br>	if ( !pParent ) return;<br><br>	TiXmlNode* pChild;<br>	TiXmlText* pText;<br>	int t = pParent-&gt;Type();<br>	printf( "%s", getIndent(indent));<br>	int num;<br><br>	switch ( t )<br>	{<br>	case TiXmlNode::DOCUMENT:<br>		printf( "Document" );<br>		break;<br><br>	case TiXmlNode::ELEMENT:<br>		printf( "Element [%s]", pParent-&gt;Value() );<br>		num=dump_attribs_to_stdout(pParent-&gt;ToElement(), indent+1);<br>		switch(num)<br>		{<br>			case 0:  printf( " (No attributes)"); break;<br>			case 1:  printf( "%s1 attribute", getIndentAlt(indent)); break;<br>			default: printf( "%s%d attributes", getIndentAlt(indent), num); break;<br>		}<br>		break;<br><br>	case TiXmlNode::COMMENT:<br>		printf( "Comment: [%s]", pParent-&gt;Value());<br>		break;<br><br>	case TiXmlNode::UNKNOWN:<br>		printf( "Unknown" );<br>		break;<br><br>	case TiXmlNode::TEXT:<br>		pText = pParent-&gt;ToText();<br>		printf( "Text: [%s]", pText-&gt;Value() );<br>		break;<br><br>	case TiXmlNode::DECLARATION:<br>		printf( "Declaration" );<br>		break;<br>	default:<br>		break;<br>	}<br>	printf( "\n" );<br>	for ( pChild = pParent-&gt;FirstChild(); pChild != 0; pChild = pChild-&gt;NextSibling()) <br>	{<br>		dump_to_stdout( pChild, indent+1 );<br>	}<br>}<br><br>// load the named file and dump its structure to STDOUT<br>void dump_to_stdout(const char* pFilename)<br>{<br>	TiXmlDocument doc(pFilename);<br>	bool loadOkay = doc.LoadFile();<br>	if (loadOkay)<br>	{<br>		printf("\n%s:\n", pFilename);<br>		dump_to_stdout( &amp;doc ); // defined later in the tutorial<br>	}<br>	else<br>	{<br>		printf("Failed to load file \"%s\"\n", pFilename);<br>	}<br>}<br><br>// ----------------------------------------------------------------------<br>// main() for printing files named on the command line<br>// ----------------------------------------------------------------------<br>int main(int argc, char* argv[])<br>{<br>	for (int i=1; i&lt;argc; i++)<br>	{<br>		dump_to_stdout(argv[i]);<br>	}<br>	return 0;<br>}<br></pre>
</div>
<p>Run this from the command line or a DOS window, e.g.:</p>
<p></p>
<div class="fragment">
<pre class="fragment">C:\dev\tinyxml&gt; Debug\tinyxml_1.exe example1.xml<br><br>example1.xml:<br>Document<br>+ Declaration<br>+ Element [Hello]<br> (No attributes)<br>  + Text: [World]<br></pre>
</div>
<p><em> Authors and Changes
<ul>
  <li>
Written by Ellers, April, May, June 2005 </li>
  <li>
Minor edits and integration into doc system, Lee Thomason September
2005 </li>
  <li>
Updated by Ellers, October 2005 </li>
</ul>
</em> </p>
</body>
</html>
